# Insurance 회귀 분석 캡스톤 프로젝트 진행상황

## 프로젝트 개요
- **파일**: `/Users/leekh/hossam-py/work.ipynb`
- **주제**: 의료보험 청구 비용(charges) 예측을 통한 의료 비용 불평등 구조 분석
- **데이터**: Insurance 데이터셋 (1,338명, 7개 변수)
- **변수**:
  - 종속변수: `charges` (의료비, USD)
  - 독립변수: `age`(나이), `sex`(성별), `bmi`(체질량지수), `smoker`(흡연여부), `children`(부양자녀수), `region`(거주지역)

## ✅ 완료된 미션

### 미션 1: 데이터 신뢰도 점검 (완료)
- 결측치 점검: 결측치 0개 확인
- 이상치 분석: charges 139개(10.39%) 이상치 확인 → 의료 현실 반영하므로 유지
- 범주형 변수 분석: sex(2범주), smoker(2범주), region(4범주) 모두 균형잡힘
- 변수 범위 현실성: 모든 변수가 현실적 범위 내
- **결론**: 원본 데이터 1,338행을 그대로 사용

### 미션 2: 의료비와 핵심 변수의 첫인상 (완료)
분석 대상: charges, age, bmi, children

**핵심 인사이트**:
- **charges**: 극단 우측 꼬리(왜도=1.51) → 로그 변환 필수
- **age**: 거의 대칭(왜도=0.06) → 변환 불필요
- **bmi**: 약한 우측 꼬리(왜도=0.28) → 변환 불필요
- **children**: 중간 우측 꼬리(왜도=0.97) → 변환 검토

**변환 전략**: log(charges) 변환으로 정규성 확보

---

## 📋 남은 미션 목록

### 미션 3: 로그/비선형 변환 비교
- charges의 변환 전·후 분포 비교 (히스토그램/KDE)
- 다른 변수들의 변환 필요성 판단
- 변환이 해석에 미치는 영향 분석
- 변환 없을 시 함정 정리

### 미션 4: 성별·지역별 분석
- sex, region별 의료비 분포 시각화 (박스플롯, 바이올린 플롯)
- 중앙값·산포 비교 및 차이 해석
- 사회·제도적 맥락 추정

### 미션 5: 흡연 효과 검정
- smoker에 따른 charges 비교 시각화
- t-test 수행 (정규성/등분산 가정 확인 후)
- 효과 크기 제시 및 의료·정책적 의미 해석

### 미션 6: 연령대별 비교 (ANOVA)
- age를 구간 분할 (18~30, 31~50, 51~)
- ANOVA + 사후검정 (Tukey HSD 또는 Games-Howell)
- 의료비 연령 서열표 작성

### 미션 7: 상관·다중공선성
- 연속형 변수 간 상관행렬 계산 및 히트맵 시각화
- VIF 계산으로 다중공선성 점검
- 공선성 대응 전략 비교

### 미션 8: 연속형 변수 상관 해석
- charges와 age, bmi, children의 Pearson/Spearman 상관계수
- 계수 선택 이유 설명
- 의료학·보건학적 맥락 해석

### 미션 9: 상관 vs 인과 구분
- 상관관계의 한계 설명
- 대리변수/누락변수 개념 언급
- 미측정 변수(직업, 교육, 소득) 영향 서술

### 미션 10: 회귀모형 설계
- 다중선형회귀 모형 설계
- 변수 선택 이유 명시
- 범주형 변수 더미 처리 (기준 범주 명시)
- 변수 변환 이유 설명

### 미션 11: 회귀계수 해석
- 계수 및 신뢰구간 해석
- 의료비 의미로 번역
- 표준화·비표준화 계수 병행 제시

### 미션 12: 모형 진단·개선
- 잔차 정규성/등분산/선형성 점검
- 영향력 분석 (Cook's distance)
- 개선 아이디어 제시

### 미션 13: 스토리텔링 종합
- 가상 개인 두 명 설정 (A vs B 시나리오)
- 회귀계수로 의료비 차이 설명
- 모델의 한계 명시
- 비전공자 수준의 이해하기 쉬운 서술

---

## 🛠️ 코딩 규칙 및 가이드라인

### 1. 미션 구조 (블록 순서 필수)
```
[마크다운] 미션 제목
  ↓
[마크다운] ### 서브 주제 제목 (서브 주제 있을 경우)
  ↓
[코드] 분석 코드
  ↓
[마크다운] 인사이트 (객관적 사실만, 추론 제외)
  ↓
(반복)
```

### 2. 데이터프레임 출력
- hossam 패키지 함수의 반환값이 DataFrame인 경우: `display()` 함수 사용
- 일반 print(): 설명 문장, 수치 요약
- 예:
  ```python
  stats_df = hs_stats.missing_values(origin)
  display(stats_df)  # DataFrame 출력

  print("설명 문장")  # 설명
  ```

### 3. hossam 패키지 활용
- **데이터 로드**: `hs_util.load_data("insurance")`
- **통계**: `hs_stats.missing_values()`, `hs_stats.outlier_table()`, `hs_stats.normal_test()`, `hs_stats.ttest_ind()`, `hs_stats.oneway_anova()`, `hs_stats.corr()`, `hs_stats.ols_report()`
- **전처리**: `hs_prep.standard_scaler()`, `hs_prep.get_dummies()`, `hs_prep.log_transform()`
- **시각화**: `hs_plot.get_default_ax()`, `hs_plot.histplot()`, `hs_plot.boxplot()`, `hs_plot.kdeplot()`, `hs_plot.barplot()`, `hs_plot.heatmap()`, `hs_plot.ols_residplot()`, `hs_plot.ols_qqplot()`

### 4. 인사이트 작성 규칙
- **대상**: 객관적 사실만 서술 (추론/해석 제외)
- **형식**: 마크다운 리스트로 요점 정리
- **예**:
  ```
  ✅ (O) "charges의 왜도는 1.51이며, 평균($13,270) > 중앙값($9,382)을 보임"
  ❌ (X) "이는 흡연자 때문일 것 같다" (추론)
  ```

### 5. 시각화 설정
- 모든 그래프: `hs_plot.finalize_plot(ax, save_path=None)` 사용
- 크기: `width=1200, height=400` (기본값)
- 언어: 한글 자동 적용 (NotoSansKR 폰트)

### 6. 변수 정보
- 원본 데이터: `origin` (정제되지 않은 원본)
- 변환된 데이터: 필요시 새로운 변수명으로 생성

---

## 📊 주요 분석 결과 (참고용)

### 데이터 기본 정보
- 관측치: 1,338명
- 결측치: 0개
- charges 범위: $1,121.87 ~ $63,770.43 (평균 $13,270.42)
- age 범위: 18~64세 (평균 39.21세)
- bmi 범위: 15.96~53.13 (평균 30.66)
- children: 0~5명 (평균 1.09명)

### 범주형 변수 분포
- sex: male 50.5%, female 49.5% (균형잡힘)
- smoker: no 79.5%, yes 20.5%
- region: southeast 27.2%, 나머지 ~24% (균형잡힘)

---

## 🔗 파일 경로 및 환경

- **작업 파일**: `/Users/leekh/hossam-py/work.ipynb`
- **데이터 원본**: hossam 패키지 내장 (load_data("insurance"))
- **Python 환경**: 3.13.9
- **hossam 버전**: 0.3.4

---

## 💡 다음 작업 시작 가이드

1. **재부팅 후** work.ipynb 열기
2. **셀 1부터 6까지 실행** (데이터 로드 및 기본 설정)
   - `from hossam import *`
   - `import pandas as pd`
   - `origin = hs_util.load_data("insurance")`
3. **미션 3부터 시작** (미션 1, 2는 이미 완료)
4. **블록 순서 유지**: 마크다운 → 코드 → 인사이트 (반드시!)
5. **display() 함수 사용**: DataFrame 출력할 때만

---

## 📝 작성 템플릿

```markdown
### [서브 주제명]

[코드 블록]

**[서브 주제명] 인사이트:**
- **관찰 1**: 객관적 사실
- **관찰 2**: 객관적 사실
- **관찰 3**: 객관적 사실
- **회귀 분석 영향**: 방법론적 시사점
```
