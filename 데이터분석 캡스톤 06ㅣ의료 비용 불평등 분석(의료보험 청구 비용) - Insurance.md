# 🏥 Insurance 회귀 분석 캡스톤

> 아이티윌 데이터분석 부트캠프 52기
> 이광호 강사 (leekh4232@gmail.com)

"왜 어떤 사람의 의료보험 청구 비용은 높고, 어떤 사람의 비용은 낮을까?"

의료 비용은 개인의 건강 상태를 반영하기도 하지만,
**나이, 성별, 거주 지역, 생활습관**에 따라 체계적으로 달라집니다.

특히 흡연 여부는 의료비를 얼마나 크게 변화시킬까?
젊은 사람도 흡연자라면 높은 비용을 지불할까?

이번 캡스톤 과제에서는 **Insurance 데이터셋**을 활용하여
개인의 인구학적·건강 특성이 **의료보험 청구 비용을 어떤 구조로 설명하는지**를
데이터와 회귀모형을 통해 단계적으로 탐구합니다.

이 과제의 목표는 예측 정확도를 높이는 것이 아니라,
**"의료 비용 불평등은 어떤 논리로 형성되는가"를 수치와 언어로 설명하는 것**입니다.

※ 본 과제는 팀 / 개인 단위 모두 수행 가능합니다.

## 데이터 불러오기

```python
load_data("insurance")
```

## 데이터 설명

개인의 기본 건강·인구학적 정보를 바탕으로 **의료보험 청구 비용**을 설명하기 위해 수집된 데이터입니다.

- 관측치: 약 1,338명

| 변수 | 설명 |
|---|---|
| charges | 의료보험 청구 비용 (종속변수, USD) |
| age | 개인의 나이 (년) |
| sex | 성별 (male, female) |
| bmi | 체질량지수 (Body Mass Index) |
| smoker | 흡연 여부 (yes, no) |
| children | 부양 자녀 수 |
| region | 거주 지역 (southwest, southeast, northwest, northeast) |

---

## 과제 수행 미션

### 미션 1. **"이 데이터는 믿을 만할까?"**

- 결측·이상치·편향을 점검하고, 처리 기준을 제시한다.
- charges가 음수이거나 극단값인지, age/bmi 등의 범위가 현실적인지 확인한다.
- 범주형 변수(sex, smoker, region)가 몇 개의 범주로 구성되어 있고, 특정 범주에 데이터가 지나치게 몰려 있지는 않은지 확인한다.
- 전처리 전·후가 어떻게 달라졌는지 한눈에 비교하는 표나 요약을 만든다.
- 단위·해석 주의: `charges`는 USD입니다. 현실적인 의료비 수준인지 평가하세요.

> 📌 **출제 의도**
> "이 값이 말이 되나?"를 먼저 묻고, 어떻게 처리했는지를 기록해 **나중 해석에 근거를 남기는 연습**입니다.


### 미션 2. **"의료비와 핵심 변수의 첫인상"**

- charges, age, bmi, children 분포를 히스토그램/KDE로 확인하고 알 수 있는 객관적 사실을 서술한다.
- 왜도/이상치가 회귀에 줄 수 있는 영향과 변환할 필요가 있는지 서술하시오.
- 분포 비교는 동일 축 스케일로 제시하고, 평균/중앙값/꼬리의 차이를 문장으로 요약하세요.
- 의료비의 long-tail 분포(극단적 고액 청구)가 해석에 미치는 영향도 짧게 언급하세요.

> 📌 **출제 의도**
> 목표변수·핵심 변수의 생김새를 먼저 읽고 **변환 필요성을 스스로 판단**하게 합니다. 숫자보다 해석 문장이 중요합니다.


### 미션 3. **"로그/비선형 변환을 고민해 보자"**

- charges 혹은 주요 변수(age, bmi, children)에 로그/제곱근 등 변환을 적용해 전후 분포를 **나란히** 비교한다.
- 변환이 해석과 모델 적합에 주는 장단점, 해석이 어떻게 달라지는지 예상한다.
- "이 변환이 없으면 어떤 함정에 빠질까?"를 한 줄로 정리한다.
- 선택 기준을 명시하세요: 왜 `log(charges)`인지, 왜 특정 변수에 변환을 적용하는지 데이터 분포 근거로 설명합니다.

※ 로그 변환은 의무가 아니며, 적용하지 않은 경우에도 그 선택의 이유와 결과적 한계를 명확히 설명하면 동일하게 평가합니다.

> 📌 **출제 의도**
> 단순히 변환을 쓰는 것이 아니라 **"왜 필요했는가, 해석이 어떻게 달라지는가"**를 설명하는 연습입니다.


### 미션 4. **"성별과 거주 지역은 의료비를 결정할까?"**

- 성별(sex)과 지역(region)별 의료비 분포를 시각화(박스플롯, 바이올린 플롯)한다.
- 중앙값·분포 겹침을 근거로 "어느 집단이 비싼가?", "차이가 얼마나 뚜렷한가?"를 문장으로 적으세요.
- "왜 이런 차이가 생겼을까?"를 건강보험 체계·지역 의료 인프라·생활 비용 차이 등으로 추정해 보세요.

> 📌 **출제 의도**
> 범주형 요인이 의료비를 **어디서 가르고 어디서 겹치는지**를 이야기로 풀어내게 합니다.


### 미션 5. **"흡연은 정말로 의료비를 크게 높일까?"**

- smoker(흡연 여부)에 따라 charges가 다른지 시각화하고, 두 집단 평균 차이를 가설검정(예: t-test)으로 확인한다.
- 효과 크기(차이의 크기)를 함께 제시하고, "실제로 의미 있는 차이인가?"를 말로 해석하세요.
- 정규성/등분산 가정 점검 후 필요 시 Welch's t-test나 비모수 검정을 선택하세요.
- 효과 크기를 의료 정책 관점에서 의미를 서술합니다.

> 📌 **출제 의도**
> 두 집단 비교에서 **방법 선택과 효과 크기 해석**을 연습하고, 숫자를 의미로 번역하게 합니다.


### 미션 6. **"나이대별로 의료비 차이가 뚜렷할까?"**

- age를 여러 구간으로 나누어(예: 18~30, 31~50, 51+) 각 연령대별 charges 분포를 시각화한다.
- 분산분석(ANOVA)으로 전체 차이를 확인하고, 사후검정으로 어느 연령대 사이에서 차이가 나는지 정리한다.
- 사후검정은 Tukey HSD 또는 Games-Howell(등분산 위반 시)을 사용하고, "의료비 연령 서열표" 형태로 요약하세요.

> 📌 **출제 의도**
> 여러 범주를 **전체→어디서 차이** 순서로 해석하며, 결과를 서열/지도처럼 정리하는 훈련입니다.


### 미션 7. **"변수들은 서로 섞여 있을까?"**

- 주요 연속형 변수 간 상관행렬(age, bmi, children, charges)을 계산하고 시각화한다.
- Variance Inflation Factor(VIF)로 다중공선성을 점검한다.
- 변수별로 의료비에 대한 예측력을 비교한다.

> 📌 **출제 의도**
> **중복 정보와 독립성**을 의식하며, 회귀에 넣을 변수를 깔끔히 설계하게 합니다.


### 미션 8. **"어떤 변수가 의료비와 가장 가까울까?"**

- charges와 age, bmi, children의 상관을 계산하고 시각화 한다.
- 각 변수의 관계를 해석하고(예: "나이가 많을수록 의료비 증가", "과체중(높은 BMI)은 의료비와 강한 관계"), 인과성을 말할 수 있는지 평가합니다.

> 📌 **출제 의도**
> 상관계수 선택 이유와 **수치→의미** 해석을 연습하며, 변수 설계의 근거를 쌓게 합니다.


### 미션 9. **"의료비를 설명하는 회귀모형 설계"**

- charges(또는 변환값)를 종속변수로 하는 다중선형회귀를 설계한다.
- 변수 선택·변환·범주형 처리 이유를 명확히 한다.

※ 범주형 변수(sex, smoker, region)는 **더미 변수(기준 범주 명시)**로 처리하며, 기준 범주 선택 이유를 간단히 서술하세요.

> 📌 **출제 의도**
> 설계 선택이 임의가 아닌 **설명 의도**에 근거하도록 훈련합니다.


### 미션 10. **"회귀계수는 무엇을 말해주나?"**

- 계수(또는 표준화 계수)와 신뢰구간, 방향·크기를 해석한다.
- "나이가 1년 늘면 의료비가 어떻게 변하는가", "흡연자는 비흡연자보다 평균 얼마나 더 높은 비용을 지불하는가" 처럼 **물리/의료적 의미**로 번역한다.
- 변환 변수가 있다면, 변환을 감안한 해석을 명확히 쓴다.
- 표준화 계수(베타)와 비표준화 계수를 병행 제시하고, 단위/변환을 고려한 해석 문장을 명확히 작성합니다.
- 범주형 변수(sex, smoker, region)의 계수는 기준 범주 대비 효과로 명확히 해석하세요.

> 📌 **출제 의도**
> 숫자를 **의료비 구조의 언어**로 바꾸는 연습입니다.


### 미션 11. **"모형 진단과 개선"**

- 잔차 선형성/정규성/독립성을 점검한다.
- 문제 지점(예: 극단적 고액 청구, 특정 집단에서의 체계적 오류)과 개선 아이디어(변환, 변수 교체/제거, 강건 회귀 등)를 제안한다.
- 분석 모형을 보고하고 해석하세요.

> 📌 **출제 의도**
> 점수보다 **가정·진단과 해석**을 통해 "얼마나 믿을 수 있는가"를 판단하게 합니다.

---

## 채점 기준 (총 100점)

|     미션 | 채점 항목                      | 배점 | 감점 기준 (해당 시 누적 감점)                                                                                                                                         |
| -----: | -------------------------- | -: | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  **1** | **데이터 신뢰도 점검**             |  7 | • 결측치·이상치 점검 없음 (-2)<br>• 결측/이상치 처리 **기준** 불명확 (-2)<br>• 처리 전·후 비교(표/요약) 없음 (-1)<br>• 변수 범위 현실성(age, bmi 등) 점검 누락 (-1)<br>• charges 단위(USD)·현실성 평가 없음 (-1) |
|  **2** | **분포 첫인상 해석**              |  7 | • 분포 시각화(히스토그램/KDE) 없음 (-2)<br>• 그래프 제시 후 해석 문장 없음 (-2)<br>• 왜도·long-tail 언급 없음 (-1)<br>• 평균·중앙값·꼬리 비교 없음 (-1)<br>• 변환 필요성 판단 언급 없음 (-1)                   |
|  **3** | **로그·비선형 변환 판단**           |  7 | • 변환 전·후 비교 시각화 없음 (-3)<br>• 변환 선택/비선택 이유 미설명 (-2)<br>• 변환이 해석에 미치는 영향 언급 없음 (-1)<br>• 변환 사용 시 해석 오류 (-1)                                                  |
|  **4** | **성별·지역별 의료비 분석**          |  7 | • 범주별 시각화 없이 수치만 제시 (-2)<br>• 중앙값·분포 겹침 해석 없음 (-2)<br>• 차이의 크기(뚜렷/미미) 언급 없음 (-1)<br>• 사회·제도적 맥락 추정 없음 (-1)<br>• 결과를 단정적으로 일반화 (-1)                         |
|  **5** | **흡연 효과 검정 및 해석**          |  8 | • 가설검정 수행 안 함 (-2)<br>• 검정 방법 선택 이유 미설명 (-1)<br>• 정규성/등분산 가정 점검 없음 (-1)<br>• 효과 크기(차이의 크기) 제시 없음 (-2)<br>• 정책·의료적 의미 해석 없음 (-2)                            |
|  **6** | **연령대별 비교 (ANOVA + 사후검정)** |  8 | • 연령 구간 설정 근거 없음 (-1)<br>• ANOVA만 수행, 사후검정 없음 (-2)<br>• 사후검정 결과 해석 없음 (-2)<br>• 연령대 간 차이 구조적 요약 없음 (-2)<br>• 분포 시각화 없음 (-1)                                |
|  **7** | **상관관계·다중공선성 점검**          |  8 | • 상관계수 계산 없음 (-2)<br>• Pearson/Spearman 선택 이유 미설명 (-1)<br>• VIF 계산 또는 논의 없음 (-2)<br>• 공선성 문제 여부 판단 없음 (-1)<br>• 공선성 대응 전략 언급 없음 (-2)                       |
|  **8** | **연속형 변수 상관 해석**           |  8 | • 상관계수 수치만 제시, 해석 없음 (-2)<br>• 의료·보건 맥락 해석 없음 (-2)<br>• 비선형 가능성 언급 없음 (-1)<br>• 상관을 인과로 오해하는 서술 (-2)<br>• 변수 간 관계 비교 정리 없음 (-1)                            |
|  **9** | **의료비 설명을 위한 회귀모형 설계**     | 14 | • 종속변수 선택·변환 이유 미기재 (-2)<br>• 변수 선택 근거 미제시 (-3)<br>• 범주형 변수 더미 처리 기준 불명확 (-3)<br>• 기준 범주 미명시 (-2)<br>• 앞선 분석 결과와 연결되지 않음 (-2)<br>• R² 등 기본 지표 해석 없음 (-2)   |
| **10** | **회귀계수 해석**                | 16 | • 계수 해석 문장 없음 (-3)<br>• 계수를 수치 나열로만 제시 (-3)<br>• 단위·의료비 의미로 번역하지 않음 (-3)<br>• 표준화/비표준화 계수 구분 없음 (-2)<br>• 범주형 변수 기준 대비 효과 해석 오류 (-3)<br>• 변환 변수 해석 오류 (-2) |
| **11** | **모형 진단 및 종합 스토리텔링**       | 10 | • 잔차 진단 그래프(QQ·잔차플롯 등) 없음 (-2)<br>• 가정 위반 여부 판단 없음 (-2)<br>• 극단치/영향력(Cook’s D 등) 논의 없음 (-2)<br>• 개선 아이디어 제시 없음 (-2)<br>• 가상 개인 사례·종합 설명 없음 (-2)            |
